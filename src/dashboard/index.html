<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Technical Debt & Startup Success Analysis</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 2rem;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header p {
        font-size: 1.1rem;
        color: #666;
        max-width: 800px;
        margin: 0 auto;
      }

      .status-indicator {
        display: inline-block;
        margin-top: 0.5rem;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .status-localhost {
        background: #e8f5e8;
        color: #2e7d32;
      }

      .status-production {
        background: #e3f2fd;
        color: #1976d2;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .metric-card {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
      }

      .metric-value {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }

      .metric-label {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .card h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: #333;
        border-bottom: 2px solid #667eea;
        padding-bottom: 0.5rem;
      }

      .chart-container {
        position: relative;
        height: 400px;
        margin: 1rem 0;
      }

      .chart-container.large {
        height: 500px;
      }

      .insights {
        background: #f8f9ff;
        border-left: 4px solid #667eea;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 0 8px 8px 0;
      }

      .insights h3 {
        color: #667eea;
        margin-bottom: 0.5rem;
      }

      .insights ul {
        margin-left: 1rem;
      }

      .insights li {
        margin-bottom: 0.5rem;
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
        font-size: 1.2rem;
        color: #666;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin-right: 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .correlation-value {
        font-size: 1.2rem;
        font-weight: bold;
        padding: 0.5rem;
        border-radius: 6px;
        display: inline-block;
        margin: 0.5rem;
      }

      .correlation-strong {
        background: #ff6b6b;
        color: white;
      }
      .correlation-moderate {
        background: #ffa726;
        color: white;
      }
      .correlation-weak {
        background: #66bb6a;
        color: white;
      }

      .summary-section {
        grid-column: 1 / -1;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
      }

      .summary-section h2 {
        color: white;
        border-bottom-color: rgba(255, 255, 255, 0.3);
      }

      .tabs {
        display: flex;
        margin-bottom: 1rem;
        border-bottom: 1px solid #ddd;
      }

      .tab {
        padding: 0.75rem 1.5rem;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1rem;
        border-bottom: 2px solid transparent;
        transition: all 0.3s ease;
      }

      .tab.active {
        border-bottom-color: #667eea;
        color: #667eea;
        font-weight: bold;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .error {
        background: #ffebee;
        color: #c62828;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        border-left: 4px solid #c62828;
      }

      .chart-loading {
        background: #f5f5f5;
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        color: #666;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Technical Debt & Startup Success Analysis</h1>
      <p>
        Comprehensive analysis of code quality metrics and their correlation
        with funding success, exit outcomes, and growth trajectories
      </p>
      <div id="statusIndicator" class="status-indicator">Loading...</div>
    </div>

    <div class="container">
      <!-- Metrics Summary -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-value" id="totalCompanies">-</div>
          <div class="metric-label">Companies Analyzed</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="totalSnapshots">-</div>
          <div class="metric-label">Code Snapshots</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="avgTechDebt">-</div>
          <div class="metric-label">Avg Tech Debt Ratio</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="successRate">-</div>
          <div class="metric-label">Series B Success Rate</div>
        </div>
      </div>

      <!-- Main Dashboard -->
      <div class="dashboard-grid">
        <!-- Primary Hypothesis: Series A vs Series B -->
        <div class="card">
          <h2>
            Primary Hypothesis: Series A Technical Debt vs Series B Success
          </h2>
          <div class="chart-container">
            <canvas id="seriesAvsB"></canvas>
          </div>
          <div class="insights" id="seriesInsights">
            <div class="loading">
              <div class="spinner"></div>
              Analyzing Series A technical debt patterns...
            </div>
          </div>
        </div>

        <!-- Exit Success Analysis -->
        <div class="card">
          <h2>Exit Success Analysis</h2>
          <div class="tabs">
            <button class="tab active" onclick="showTab('exit-overview')">
              Overview
            </button>
            <button class="tab" onclick="showTab('exit-metrics')">
              Tech Debt by Exit
            </button>
          </div>
          <div id="exit-overview" class="tab-content active">
            <div class="chart-container">
              <canvas id="exitAnalysis"></canvas>
            </div>
          </div>
          <div id="exit-metrics" class="tab-content">
            <div class="chart-container">
              <canvas id="exitTechDebt"></canvas>
            </div>
          </div>
          <div class="insights" id="exitInsights">
            <div class="loading">
              <div class="spinner"></div>
              Analyzing exit outcomes vs technical debt...
            </div>
          </div>
        </div>

        <!-- Funding Trajectory Analysis -->
        <div class="card">
          <h2>Funding Trajectory Analysis</h2>
          <div class="chart-container">
            <canvas id="trajectoryAnalysis"></canvas>
          </div>
          <div class="insights" id="trajectoryInsights">
            <div class="loading">
              <div class="spinner"></div>
              Analyzing funding progression patterns...
            </div>
          </div>
        </div>

        <!-- Time-to-Funding Correlation -->
        <div class="card">
          <h2>Time-to-Funding Correlation</h2>
          <div class="chart-container">
            <canvas id="timeCorrelation"></canvas>
          </div>
          <div class="insights" id="timeInsights">
            <div class="loading">
              <div class="spinner"></div>
              Calculating time-gap correlations...
            </div>
          </div>
        </div>

        <!-- Technical Debt Evolution -->
        <div class="card">
          <h2>Technical Debt Evolution</h2>
          <div class="chart-container large">
            <canvas id="evolutionChart"></canvas>
          </div>
          <div class="insights" id="evolutionInsights">
            <div class="loading">
              <div class="spinner"></div>
              Tracking technical debt evolution over time...
            </div>
          </div>
        </div>

        <!-- Funding Amount vs Technical Debt -->
        <div class="card">
          <h2>Funding Amount vs Technical Debt</h2>
          <div class="chart-container">
            <canvas id="amountCorrelation"></canvas>
          </div>
          <div class="insights" id="amountInsights">
            <div class="loading">
              <div class="spinner"></div>
              Analyzing funding amount correlations...
            </div>
          </div>
        </div>

        <!-- Key Findings Summary -->
        <div class="card summary-section">
          <h2>Key Findings & Statistical Summary</h2>
          <div id="correlationMatrix"></div>
          <div class="insights" id="summaryInsights">
            <div class="loading">
              <div class="spinner"></div>
              Generating comprehensive analysis summary...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Load Chart.js before our script -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      // Global data storage
      let analyticsData = null;

      // Utility functions
      function showTab(tabId) {
        document
          .querySelectorAll(".tab-content")
          .forEach((el) => el.classList.remove("active"));
        document
          .querySelectorAll(".tab")
          .forEach((el) => el.classList.remove("active"));
        document.getElementById(tabId).classList.add("active");
        event.target.classList.add("active");
      }

      function formatNumber(num) {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + "M";
        if (num >= 1000) return (num / 1000).toFixed(1) + "K";
        return num.toFixed(2);
      }

      function updateStatusIndicator() {
        const indicator = document.getElementById("statusIndicator");
        if (isLocalhost()) {
          indicator.textContent = "ðŸŸ¢ Live Data (API)";
          indicator.className = "status-indicator status-localhost";
        } else {
          indicator.textContent = "ðŸ“„ Static Data";
          indicator.className = "status-indicator status-production";
        }
      }

      function isLocalhost() {
        return (
          window.location.hostname === "localhost" ||
          window.location.hostname === "127.0.0.1" ||
          window.location.hostname === ""
        );
      }

      function showError(elementId, message) {
        const element = document.getElementById(elementId);
        if (element) {
          element.innerHTML = `<div class="error"><strong>Error:</strong> ${message}</div>`;
        }
      }

      function showChartPlaceholder(canvasId, message) {
        const canvas = document.getElementById(canvasId);
        if (canvas) {
          const container = canvas.parentElement;
          container.innerHTML = `<div class="chart-loading">${message}</div>`;
        }
      }

      // Wait for Chart.js to be available
      function waitForChart(callback) {
        if (typeof Chart !== "undefined") {
          callback();
        } else {
          console.log("Waiting for Chart.js to load...");
          setTimeout(() => waitForChart(callback), 100);
        }
      }

      // Main data loading function
      async function loadData() {
        updateStatusIndicator();

        try {
          let data;

          if (isLocalhost()) {
            console.log("Loading data from API (localhost detected)");
            const response = await fetch("/api/analysis-data");
            if (!response.ok) throw new Error(`API error: ${response.status}`);
            data = await response.json();
          } else {
            console.log("Loading static demo data");
            // Create demo data for testing
            data = createDemoData();
          }

          analyticsData = data;
          updateMetrics();

          // Wait for Chart.js then create visualizations
          waitForChart(() => {
            createVisualizations();
          });
        } catch (error) {
          console.error("Error loading data:", error);
          showError(
            "seriesInsights",
            "Failed to load analytics data. Using demo data for visualization testing."
          );

          // Fallback to demo data
          analyticsData = createDemoData();
          updateMetrics();
          waitForChart(() => {
            createVisualizations();
          });
        }
      }

      // Create demo data for testing
      function createDemoData() {
        return {
          summary: {
            totalCompanies: 142,
            totalSnapshots: 847,
            avgTechDebt: 23.7,
            seriesBSuccessRate: 34.5,
            keyInsights: [
              "Companies with <20% technical debt at Series A are 2.3x more likely to reach Series B",
              "Average time to next funding round increases by 4.2 months for every 10% increase in technical debt",
              "Successful exits correlate with consistent technical debt management across funding rounds",
              "High-performing companies maintain technical debt below 25% through Series B",
            ],
            correlationMatrix: {
              seriesBCorrelation: -0.412,
              timeCorrelation: 0.387,
              amountCorrelation: -0.203,
            },
          },
          coreAnalysis: {
            seriesAVsSeriesB: {
              scatterData: generateScatterData(50),
              correlation: -0.412,
              correlationStrength: "Moderate Negative",
              insights: [
                "Strong inverse correlation between Series A technical debt and Series B success",
                "Companies with >30% tech debt have only 15% Series B success rate",
                "Sweet spot appears to be maintaining <20% technical debt ratio",
              ],
            },
            exitSuccessAnalysis: {
              exitCounts: { acquired: 23, ipo: 8, closed: 34 },
              exitTechDebtData: [
                { exitState: "acquired", avgTechnicalDebt: 0.187 },
                { exitState: "ipo", avgTechnicalDebt: 0.156 },
                { exitState: "closed", avgTechnicalDebt: 0.342 },
              ],
              insights: [
                "Acquired companies had 18.7% average technical debt",
                "IPO companies maintained lowest technical debt at 15.6%",
                "Failed companies showed 34.2% average technical debt",
              ],
            },
            fundingTrajectoryAnalysis: {
              trajectoryData: [
                { trajectory: "Seed Only", companyCount: 28 },
                { trajectory: "Series A", companyCount: 45 },
                { trajectory: "Series B", companyCount: 35 },
                { trajectory: "Series C+", companyCount: 18 },
              ],
              insights: [
                "68% of companies reach at least Series A",
                "Series B represents major milestone with 47% dropout",
                "Technical debt management critical for later stage success",
              ],
            },
            timeGapAnalysis: {
              scatterData: generateTimeScatterData(40),
              correlation: 0.387,
              correlationStrength: "Moderate Positive",
              insights: [
                "Higher technical debt correlates with longer funding cycles",
                "Companies with <15% debt close rounds 4.2 months faster",
                "Optimal technical debt range: 12-18% for fastest funding",
              ],
            },
            technicalDebtEvolution: {
              evolutionSeries: [
                { roundType: "Seed", avgTechnicalDebt: 0.145 },
                { roundType: "Series A", avgTechnicalDebt: 0.198 },
                { roundType: "Series B", avgTechnicalDebt: 0.234 },
                { roundType: "Series C+", avgTechnicalDebt: 0.187 },
              ],
              insights: [
                "Technical debt naturally increases through Series B",
                "Successful companies reduce debt after Series B",
                "Critical inflection point at 23-25% debt ratio",
              ],
            },
            fundingAmountCorrelation: {
              scatterData: generateFundingScatterData(45),
              correlation: -0.203,
              correlationStrength: "Weak Negative",
              insights: [
                "Larger funding rounds correlate with lower technical debt",
                "Clean code signals better execution to investors",
                "Technical debt impacts valuation negotiations",
              ],
            },
          },
        };
      }

      function generateScatterData(count) {
        const data = [];
        for (let i = 0; i < count; i++) {
          const techDebt = Math.random() * 0.5 + 0.1;
          const complexity = Math.random() * 0.4 + 0.2;
          const reachedSeriesB =
            techDebt < 0.25 ? Math.random() > 0.3 : Math.random() > 0.7;

          data.push({
            companyName: `Company ${i + 1}`,
            technicalDebtRatio: techDebt,
            complexityDensity: complexity,
            reachedSeriesB: reachedSeriesB,
          });
        }
        return data;
      }

      function generateTimeScatterData(count) {
        const data = [];
        for (let i = 0; i < count; i++) {
          const techDebt = Math.random() * 0.4 + 0.1;
          const timeToNext = 6 + techDebt * 24 + Math.random() * 8;

          data.push({
            companyName: `Company ${i + 1}`,
            technicalDebtRatio: techDebt,
            timeToNextRound: timeToNext,
            fromRound: "Series A",
            toRound: "Series B",
          });
        }
        return data;
      }

      function generateFundingScatterData(count) {
        const data = [];
        const rounds = ["Seed", "Series A", "Series B", "Series C"];

        for (let i = 0; i < count; i++) {
          const techDebt = Math.random() * 0.4 + 0.1;
          const roundType = rounds[Math.floor(Math.random() * rounds.length)];
          let baseAmount;

          switch (roundType) {
            case "Seed":
              baseAmount = 500000;
              break;
            case "Series A":
              baseAmount = 5000000;
              break;
            case "Series B":
              baseAmount = 15000000;
              break;
            case "Series C":
              baseAmount = 40000000;
              break;
          }

          const fundingAmount =
            baseAmount * (0.5 + Math.random() * 2) * (1 - techDebt * 0.3);

          data.push({
            companyName: `Company ${i + 1}`,
            technicalDebtRatio: techDebt,
            fundingAmount: fundingAmount,
            roundType: roundType,
          });
        }
        return data;
      }

      // Update summary metrics
      function updateMetrics() {
        if (!analyticsData || !analyticsData.summary) return;

        const summary = analyticsData.summary;

        document.getElementById("totalCompanies").textContent =
          summary.totalCompanies;
        document.getElementById("totalSnapshots").textContent =
          summary.totalSnapshots;
        document.getElementById("avgTechDebt").textContent =
          summary.avgTechDebt.toFixed(1) + "%";
        document.getElementById("successRate").textContent =
          summary.seriesBSuccessRate.toFixed(1) + "%";
      }

      // Create all visualizations
      function createVisualizations() {
        if (!analyticsData || !analyticsData.coreAnalysis) {
          console.error("No analytics data available for visualizations");
          return;
        }

        console.log(
          "Creating visualizations with Chart.js version:",
          Chart.version
        );

        try {
          createSeriesAVsBAnalysis();
          createExitAnalysis();
          createTrajectoryAnalysis();
          createTimeCorrelation();
          createEvolutionChart();
          createAmountCorrelation();
          createSummaryAnalysis();
        } catch (error) {
          console.error("Error creating visualizations:", error);
          showError(
            "seriesInsights",
            "Error creating charts: " + error.message
          );
        }
      }

      function createSeriesAVsBAnalysis() {
        const canvas = document.getElementById("seriesAvsB");
        if (!canvas) return;

        const analysis = analyticsData.coreAnalysis.seriesAVsSeriesB;
        if (!analysis || !analysis.scatterData) return;

        const data = analysis.scatterData;

        const ctx = canvas.getContext("2d");
        new Chart(ctx, {
          type: "scatter",
          data: {
            datasets: [
              {
                label: "Reached Series B",
                data: data
                  .filter((d) => d.reachedSeriesB)
                  .map((d) => ({
                    x: d.technicalDebtRatio,
                    y: d.complexityDensity,
                  })),
                backgroundColor: "rgba(102, 126, 234, 0.7)",
                borderColor: "rgba(102, 126, 234, 1)",
                pointRadius: 6,
              },
              {
                label: "Stopped at Series A",
                data: data
                  .filter((d) => !d.reachedSeriesB)
                  .map((d) => ({
                    x: d.technicalDebtRatio,
                    y: d.complexityDensity,
                  })),
                backgroundColor: "rgba(255, 107, 107, 0.7)",
                borderColor: "rgba(255, 107, 107, 1)",
                pointRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                title: { display: true, text: "Technical Debt Ratio" },
                min: 0,
                max: 0.6,
              },
              y: {
                title: { display: true, text: "Complexity Density" },
                min: 0,
                max: 0.8,
              },
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (ctx) {
                    const point = data.find(
                      (d) =>
                        Math.abs(d.technicalDebtRatio - ctx.parsed.x) < 0.001 &&
                        Math.abs(d.complexityDensity - ctx.parsed.y) < 0.001
                    );
                    return point
                      ? `${point.companyName}: Tech Debt ${(
                          point.technicalDebtRatio * 100
                        ).toFixed(1)}%`
                      : "";
                  },
                },
              },
            },
          },
        });

        // Update insights
        const insightsHtml = `
        <h3>Key Insights</h3>
        <ul>
          ${analysis.insights.map((insight) => `<li>${insight}</li>`).join("")}
        </ul>
        <p><strong>Correlation:</strong> ${analysis.correlation.toFixed(3)} (${
          analysis.correlationStrength
        })</p>
      `;
        document.getElementById("seriesInsights").innerHTML = insightsHtml;
      }

      function createExitAnalysis() {
        const analysis = analyticsData.coreAnalysis.exitSuccessAnalysis;
        if (!analysis) return;

        // Exit counts pie chart
        const ctx1 = document.getElementById("exitAnalysis");
        if (ctx1) {
          const exitData = Object.entries(analysis.exitCounts);
          new Chart(ctx1.getContext("2d"), {
            type: "doughnut",
            data: {
              labels: exitData.map(
                ([state]) => state.charAt(0).toUpperCase() + state.slice(1)
              ),
              datasets: [
                {
                  data: exitData.map(([, count]) => count),
                  backgroundColor: [
                    "rgba(102, 126, 234, 0.8)",
                    "rgba(76, 175, 80, 0.8)",
                    "rgba(255, 193, 7, 0.8)",
                  ],
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { position: "bottom" } },
            },
          });
        }

        // Technical debt by exit type
        const ctx2 = document.getElementById("exitTechDebt");
        if (ctx2) {
          new Chart(ctx2.getContext("2d"), {
            type: "bar",
            data: {
              labels: analysis.exitTechDebtData.map(
                (d) =>
                  d.exitState.charAt(0).toUpperCase() + d.exitState.slice(1)
              ),
              datasets: [
                {
                  label: "Average Technical Debt Ratio",
                  data: analysis.exitTechDebtData.map(
                    (d) => d.avgTechnicalDebt * 100
                  ),
                  backgroundColor: "rgba(102, 126, 234, 0.7)",
                  borderColor: "rgba(102, 126, 234, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: { display: true, text: "Technical Debt Ratio (%)" },
                },
              },
            },
          });
        }

        // Update insights
        const insightsHtml = `
        <h3>Exit Analysis Insights</h3>
        <ul>
          ${analysis.insights.map((insight) => `<li>${insight}</li>`).join("")}
        </ul>
      `;
        document.getElementById("exitInsights").innerHTML = insightsHtml;
      }

      function createTrajectoryAnalysis() {
        const analysis = analyticsData.coreAnalysis.fundingTrajectoryAnalysis;
        if (!analysis) return;

        const ctx = document.getElementById("trajectoryAnalysis");
        if (!ctx) return;

        new Chart(ctx.getContext("2d"), {
          type: "bar",
          data: {
            labels: analysis.trajectoryData.map((d) => d.trajectory),
            datasets: [
              {
                label: "Number of Companies",
                data: analysis.trajectoryData.map((d) => d.companyCount),
                backgroundColor: "rgba(118, 75, 162, 0.7)",
                borderColor: "rgba(118, 75, 162, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "Number of Companies" },
              },
              x: {
                title: { display: true, text: "Highest Funding Round Reached" },
              },
            },
          },
        });

        const insightsHtml = `
        <h3>Funding Trajectory Insights</h3>
        <ul>
          ${analysis.insights.map((insight) => `<li>${insight}</li>`).join("")}
        </ul>
      `;
        document.getElementById("trajectoryInsights").innerHTML = insightsHtml;
      }

      function createTimeCorrelation() {
        const analysis = analyticsData.coreAnalysis.timeGapAnalysis;
        if (!analysis) return;

        const ctx = document.getElementById("timeCorrelation");
        if (!ctx) return;

        new Chart(ctx.getContext("2d"), {
          type: "scatter",
          data: {
            datasets: [
              {
                label: "Time to Next Round",
                data: analysis.scatterData.map((d) => ({
                  x: d.technicalDebtRatio,
                  y: d.timeToNextRound,
                })),
                backgroundColor: "rgba(255, 193, 7, 0.7)",
                borderColor: "rgba(255, 193, 7, 1)",
                pointRadius: 5,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                title: { display: true, text: "Technical Debt Ratio" },
                min: 0,
                max: 0.6,
              },
              y: {
                title: { display: true, text: "Months to Next Round" },
                min: 0,
                max: 36,
              },
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (ctx) {
                    const point = analysis.scatterData[ctx.dataIndex];
                    return point
                      ? `${point.companyName}: ${point.fromRound} â†’ ${
                          point.toRound
                        } (${point.timeToNextRound.toFixed(1)} months)`
                      : "";
                  },
                },
              },
            },
          },
        });

        const insightsHtml = `
        <h3>Time Correlation Insights</h3>
        <ul>
          ${analysis.insights.map((insight) => `<li>${insight}</li>`).join("")}
        </ul>
        <p><strong>Correlation:</strong> ${analysis.correlation.toFixed(3)} (${
          analysis.correlationStrength
        })</p>
      `;
        document.getElementById("timeInsights").innerHTML = insightsHtml;
      }

      function createEvolutionChart() {
        const analysis = analyticsData.coreAnalysis.technicalDebtEvolution;
        if (!analysis) return;

        const ctx = document.getElementById("evolutionChart");
        if (!ctx) return;

        new Chart(ctx.getContext("2d"), {
          type: "line",
          data: {
            labels: analysis.evolutionSeries.map((d) => d.roundType),
            datasets: [
              {
                label: "Average Technical Debt Ratio",
                data: analysis.evolutionSeries.map(
                  (d) => d.avgTechnicalDebt * 100
                ),
                borderColor: "rgba(102, 126, 234, 1)",
                backgroundColor: "rgba(102, 126, 234, 0.1)",
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointHoverRadius: 8,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "Technical Debt Ratio (%)" },
              },
              x: {
                title: { display: true, text: "Funding Round" },
              },
            },
          },
        });

        const insightsHtml = `
        <h3>Evolution Insights</h3>
        <ul>
          ${analysis.insights.map((insight) => `<li>${insight}</li>`).join("")}
        </ul>
      `;
        document.getElementById("evolutionInsights").innerHTML = insightsHtml;
      }

      function createAmountCorrelation() {
        const analysis = analyticsData.coreAnalysis.fundingAmountCorrelation;
        if (!analysis) return;

        const ctx = document.getElementById("amountCorrelation");
        if (!ctx) return;

        new Chart(ctx.getContext("2d"), {
          type: "scatter",
          data: {
            datasets: [
              {
                label: "Funding Amount vs Technical Debt",
                data: analysis.scatterData.map((d) => ({
                  x: d.technicalDebtRatio,
                  y: d.fundingAmount,
                })),
                backgroundColor: "rgba(76, 175, 80, 0.7)",
                borderColor: "rgba(76, 175, 80, 1)",
                pointRadius: 5,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                title: { display: true, text: "Technical Debt Ratio" },
                min: 0,
                max: 0.6,
              },
              y: {
                type: "logarithmic",
                title: {
                  display: true,
                  text: "Funding Amount (USD, log scale)",
                },
              },
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (ctx) {
                    const point = analysis.scatterData[ctx.dataIndex];
                    return point
                      ? `${point.companyName} (${
                          point.roundType
                        }): $${formatNumber(point.fundingAmount)}`
                      : "";
                  },
                },
              },
            },
          },
        });

        const insightsHtml = `
        <h3>Funding Amount Insights</h3>
        <ul>
          ${analysis.insights.map((insight) => `<li>${insight}</li>`).join("")}
        </ul>
        <p><strong>Correlation:</strong> ${analysis.correlation.toFixed(3)} (${
          analysis.correlationStrength
        })</p>
      `;
        document.getElementById("amountInsights").innerHTML = insightsHtml;
      }

      function createSummaryAnalysis() {
        const summary = analyticsData.summary;
        if (!summary) return;

        // Correlation matrix
        const correlationHtml = `
        <h3>Correlation Matrix</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
          <div class="correlation-value correlation-${
            Math.abs(summary.correlationMatrix.seriesBCorrelation) >= 0.3
              ? "strong"
              : Math.abs(summary.correlationMatrix.seriesBCorrelation) >= 0.1
              ? "moderate"
              : "weak"
          }">
            Series B Success: ${summary.correlationMatrix.seriesBCorrelation.toFixed(
              3
            )}
          </div>
          <div class="correlation-value correlation-${
            Math.abs(summary.correlationMatrix.timeCorrelation) >= 0.3
              ? "strong"
              : Math.abs(summary.correlationMatrix.timeCorrelation) >= 0.1
              ? "moderate"
              : "weak"
          }">
            Time to Funding: ${summary.correlationMatrix.timeCorrelation.toFixed(
              3
            )}
          </div>
          <div class="correlation-value correlation-${
            Math.abs(summary.correlationMatrix.amountCorrelation) >= 0.3
              ? "strong"
              : Math.abs(summary.correlationMatrix.amountCorrelation) >= 0.1
              ? "moderate"
              : "weak"
          }">
            Funding Amount: ${summary.correlationMatrix.amountCorrelation.toFixed(
              3
            )}
          </div>
        </div>
      `;

        document.getElementById("correlationMatrix").innerHTML =
          correlationHtml;

        // Summary insights
        const insightsHtml = `
        <h3>Executive Summary</h3>
        <ul>
          ${summary.keyInsights
            .map((insight) => `<li>${insight}</li>`)
            .join("")}
        </ul>
      `;
        document.getElementById("summaryInsights").innerHTML = insightsHtml;
      }

      // Initialize dashboard
      document.addEventListener("DOMContentLoaded", function () {
        loadData();
      });
    </script>
  </body>
</html>
